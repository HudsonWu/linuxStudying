# iproute2使用中需要了解的一些概念


## netlink

`netlink`, 一种特殊的socket, linux所特有的, 类似于BSD中的`AF_ROUTE`, 但比它功能强大. 用于在内核模块和用户之间传递信息

可用于进程间通信, linux内核与用户空间的进程间、用户进程间的通讯, 它不像网络套接字可以用于主机间通讯, netlink只能用于同一主机上进程通讯, 并通过PID来标识它们

## 网络接口相关

qdisc (queuing discipline), 显示这个网络接口使用的排队算法
noqueue, 表示不对数据包进行排队
noop, 表示这个网络接口处于黑洞模式, 也就是所有进入的数据会直接被丢弃
qlen, 网络接口传输队列的默认长度

### 网络接口的标志

UP, 这个设备处于运行状态, 可以接受、发送数据包

LOOPBACK, 这个接口不能用于其它的主机通讯, 所有发送到这个接口的数据包都会返回, 而且这种接口只能接收反弹回来的数据包

BROADCAST, 这个设备具有把数据包发送到所有主机的能力, 以太网连接是一个很典型的例子

POINTTOPOINT, 两个节点之间是直接连接的, 某个节点发出的所有数据包都会发送到对端节点, 接收到的所有数据包也都是从对端节点发过来的

MULTICAST, 表示设备具有多播能力, 能够把数据包发送到某些相邻的网络节点, 实际上, 广播是多播的一个特例, 它的多播组包括连接上的所有节点, 从定义上, POINTTOPOINT和BROADCAST连接都属于多播

如果网络接口的标志不属于LOOPBACK、BROADCAST、POINTTOPOINT的任何一个, 就假定是NMBA(Non-Broadcast Multi-Access)类型, 这是最为普遍的一个标志

PROMISC, 设备处于混杂模式, 接收连接上的所有数据, 不管目的地址是否是自己, 通常, 这种模式主要用于网桥和网络监视

ALLMULTI, 设备接收连接上的所有多播数据包, 多播路由器(multicast router)使用这种模式

NOARP, 这个标志和其他标志不同, 它的含义和涉及的网络协议有关, 一般表示这个设备无需地址解析, 软件或者硬件不必借助于系统协议栈的帮助就知道如何把数据包投递到目的地

DYNAMIC, 表示这个网络接口是动态建立和撤销的

SLAVE, 表示这个接口被绑定到其它的网络接口上

### 网络接口的统计信息

RX和TX分别是接收和发送统计信息的开头

bytes, 网络接口发送或者收到的字节数, 如果字节数超过数据类型能够表示的最大数值, 就会造成回卷. 如果想连续监视这个指标, 需要一个用户空间的监控进程周期性地保存这个数据

packets, 网络接口收到或者发送的数据包个数

errors, 发生错误的次数

dropped, 由于系统资源限制, 而丢弃数据包的数量

overrun, 由于发生堵塞, 收到的数据包被丢弃的数量. 如果接口发生堵塞, 就意味着内核或者你的机器太慢, 无法处理收到的数据

mcast, 收到的多播数据包数量, 只有很少的设备支持这个选项

carrier, 连接介质出现故障的次数, 如网线接触不好

collsns, 以太网类型介质发生冲突的事件次数

compressed, 压缩数据包的总数, 这个指标只适用于使用VJ头压缩的网络接口

## 路由类型

unicast, 描述到目的地址的真实路径, 一般情况下, 通常的路由表只有这种类型的路由条目unreachable, 这些目的地址是不可达的, 如果发过去的数据包都被丢弃且收到ICMP信息"host unreachable", 目的地址就会被标记为不可达, 在这种情况下, 本地发送者将返回EHOSTUNREACH错误

blackhole, 这些目的地址不可达, 而且发过去的数据包都被丢弃, 本地发送者将返回EINVAL错误

prohibit, 这些路由是不可达的, 发过去的数据包被丢弃, 产生ICMP信息, "communication administractively prohibited", 本地发送者会返回EACCESS错误

local, 目的地址被分配给本机, 数据包通过回环投递到本地

broadcast, 目的地址是广播地址, 数据包作为链路广播发送

throw, 和策略规则(policy rule)一块使用的控制路由, 如果选择了这种路由, 会认为没有发现路由, 在这个表中的查询会被终止, 没有找到策略路由就相当于在路由表中没有找到路由, 数据包会被丢弃, 并产生ICMP信息, net unreachable, 本地发送者会返回ENETUNREACH错误

nat, 特定的NAT路由, 目标地址属于哑地址(外部地址), 在转发前需要进行地址转换

anycast, 目标是anycast地址, 被分配给本机, 这类地址和本地地址大同小异, 不同的是这类地址不能用于任何数据包的源地址

multicast, 使用多播路由, 在普通的路由表中, 这种路由并不存在
